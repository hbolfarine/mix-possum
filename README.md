## Repository for density and cluster summaries for Bayesian models

This repository is associated with the paper *“Lower-dimensional
posterior density and cluster summaries for overparameterized Bayesian
models,”* see [arXiv](https://arxiv.org/abs/2506.09850), and provides codes and tutorials on one of the
numerical examples.

This tutorial contains `R` code to perform the analysis of the simple
example. Here, we present the three-step procedure of our method. We
recommend executing the code below in the order in which it is
presented, but changes can be made in the solution path length and in
the size of the credible interval of the posterior summary.

For the remaining numerical examples contained in the paper, you can download the scripts on this Dropbox link.

------------------------

In this first example we apply our method to analyze the galaxy data. galaxy data comprising of 82 galaxy velocities, measured in 103 kilometers per second diverging from our own, sampled from the Corona Borealis (see Roeder, 1990).

```R
# Loading the data
y.data.app = data_sim_func("galaxy")
set.seed(1800) 
```
### 1. Run the method
z`
Necessary files:
```R
source("source/dcpossum_dens_comp.R")
source("source/dcpossum_sim_data_mix.R")
source("source/dcpossum_plots.R")
source("source/dcpossum_unc.R")
source("source/func_pred_laplace_temp.R")
source("source/dcpossum_clust.R")
```

In this first step we estimate the density using Dirichlet process
mixture models, using the `dirichletprocess` [package](https://cran.r-project.org/web/packages/dirichletprocess/vignettes/dirichletprocess.pdf). We then
generate a sequence of Gaussian mixture model (GMM) summary estimates.
The maximum number of components of the GMM summaries is defined as
*K*<sub>max</sub> = 10.
```R
DPM.galaxy = dcpossum.DPM.dir(y.data.app, kmax = 10, quant.sample = 1000, 
                              k0 = 1/10, pred.f = TRUE)
```
The posterior distribution on the number of components or groups for the
Dirichlet process is given in the plot below:
```R
comp_DPM = plot_posterior_components(table(DPM.galaxy[[3]]))
```
### 2. Discrepancy function

Below is the discrepancy function plot indicating that a GMM summary
with four components provides a good approximation to the predictive
distribution of the original model under a KL divergence.
```R
DPM_comp_galaxy = plot.possum.uni(DPM.galaxy[[1]], kmax = 10, sel.K = FALSE, 
                                  y.lim = c(-1.1,0.4))
DPM_comp_galaxy
```
![](figure-markdown_strict/unnamed-chunk-3-1.png)

### 3. Posterior summarization

Below we generate the posterior summarization under a GMM surrogate with
*K*<sup>\*</sup> = 4 components.

```R
K_star = 4
possum.DPM.galaxy = possum.unc.quant.values(DPM.galaxy, K.sel = K_star)
```

### 3. Posterior density summarization plot

The plot below depicts a histogram of the galaxy data, the posterior
expected density of the original model (black-dashed line). The blue
line is a GMM with a *K*<sup>\*</sup> = 4 component summary estimate.
The grey ribbon is the 95% credible interval generated by the posterior
summary, in which the red line is the average of this summary.

```R
plots.possum.exemp.DPM = plot.possum.quant(possum.DPM.galaxy, K.sel = K_star, 
                                           scale.plot = FALSE, model = "DPM",
                                           y.data.app, index.possum = FALSE, 
                                           index.pred = "galaxy")
plots.possum.exemp.DPM$dens.summ
```
<img src="figure-markdown_strict/unnamed-chunk-6-1.png" style="display: block; margin: auto;" />

### 4. Posterior cluster summaries plot

In the plot below we display the cluster allocation estimate and
posterior summary cluster allocation.

```R
possum_clust = dc.possum.clust.uni(DPM.galaxy, y.data.app, K.sel = K_star, km = TRUE)

dat.clust.DPM = process_clustering_uni(DPM.galaxy[[6]], possum_clust, K_star, y.data.app)

plot.galaxy.DPM = create_custom_plot(dat.clust.DPM,
                                     plots.possum.exemp.DPM$dens.summ,
                                     k_star = K_star, y.min.plot = -0.05, 
                                     y.max.plot = 0.3, 
                                     y.c = -0.012, y.k = -0.03, 
                                     text_plot = "Velocities of Galaxies")

p.legend <- ggdraw() +
    draw_plot(plot.galaxy.DPM) +  # Your main plot
    draw_plot(plots.possum.exemp.DPM$legend, x = 0.1, y = 0.6, 
              width = 0.25, height = 0.25) 

p.legend
```
<img src="figure-markdown_strict/unnamed-chunk-8-1.png" style="display: block; margin: auto;" />
